# Figures

## Scoring accuracy
![Schematic illustrating accuracy components of scoring function](figures/deconvolution_contest Fig2_Final_revised.png)

## Accuracy vs. Speed
```{r, echo=FALSE, warning=FALSE}
my.pal <- palette(c("dodgerblue","brown","orange"))
library(data.table)
library(ggplot2)
library(ggrepel)
library(dplyr, warn=F)
```

```{r, echo=FALSE}
# data
speed_acc <- fread("data/holdout_score_time.txt")
soln_desc <- fread("data/solution_descriptions.txt", na.strings="n/a")
speed_acc <- merge(speed_acc, soln_desc, by="handle")
```

```{r, echo=FALSE}
# compute composite accuracy
# in contest, aggregate score was computed as:
# SCORE = MAX_SCORE * (MAX(CORp, 0))2 * AUCp2 * exp(- Tsolution / (3 * Tbenchmark) )
speed_acc[, acc := cor^2 * auc^2]
```


```{r speed_acc, echo=FALSE, fig.cap="\\label{speed_acc}Accuracy vs. Speed", fig.width=6}
# plot
# let's just show one plate for now
ggplot(speed_acc[grepl("^DPK", plate)],
       aes(x=sec, y=acc, label=rank)) +
  geom_point(aes(color=method_short), size=2) +
  geom_text_repel() +
  scale_color_discrete(name="Method class") +
  xlab("Time (seconds)") +
  ylab("Accuracy") +
  theme_classic() +
  ggtitle("Accuracy vs. Speed")
```

## Accuracy vs speed (AB)

```{r setup, echo=F}
impute <- function(x, value) ifelse(is.na(x), value, x)
n <- nrow(speed_acc)
attach(speed_acc)
```

```{r acc-vs-speed, fig.width=2.75*3, fig.height=2.75, fig.cap=cap, echo=FALSE}
cap <- "\\label{fig:acc-vs-speed}Accuracy vs speed on the holdout dataset for the top-nine solutions, by plate. Labels at the dots indicate the rank of the submission in the final leaderboard (1 = first best, 2 = second best, etc.). Dashed lines indicate levels with no improvement over the benchmark. Dotted lines indicate (ols) association between accuracy and speed improvements."

# compute measures
bench <- handle=="benchmark"
sec.bench <- sec[bench]
auc.bench <- auc[bench]
cor.bench <- cor[bench]
kd.bench <- kd_success_freq[bench]
auc.pc <- auc/auc.bench[factor(plate)]
cor.pc <- cor/cor.bench[factor(plate)]
sec.pc <- sec/sec.bench[factor(plate)]
kd.pc <- kd_success_freq/kd.bench[factor(plate)]
method2 <- method
method2[grep("Gaussian", method)] <- "gaussian mixture"
method2[grep("forest", method)] <- "rand. forest"

# Plot
panel <- function(x,y, xlim=c(0,5),ylim=c(0,0.08),xlab="speed increase (%)", legend=T, ...){
  plot(y ~ x, xlim=xlim, ylim=ylim, xlab=xlab
    , pch=c(15:16)[factor(plate)]
    , col=c(1,2)[factor(plate)]
    , subset=!bench
    ,...)
  # lable best method
  j <- which.max(y)
  y.offset <- +0.002; x.offset <- -1
  segments(y0=y[j], x0=x[j], y1=y[j] + y.offset, x1=x[j]+x.offset)
  text(y=y[j]+y.offset, x=x[j]+x.offset, labels=method2[j], pos=3)
  # label fastest method
  j <- which.max(x)
  y.offset <- -0.001; x.offset <- -0.2
  segments(y0=y[j], x0=x[j], y1=y[j] + y.offset, x1=x[j]+x.offset)
  text(y=y[j]+y.offset, x=x[j]+x.offset, labels=method2[j], pos=1)
  # legend
  if(legend)
    legend("topright", pch=15:16, col=1:2, legend=c("plate 1", "plate 2"), bty="n")
  # rank labels
  text(y=y[!bench],x=x[!bench],labels=rank[!bench],pos=3,xpd=T, col=gray(.75))
  abline(h=0,lty=2)
  abline(v=0,lty=2)
  abline(lm(y[!bench] ~ x[!bench]), lty=3)
}
par(mfrow=c(1,3), mar=c(4,4,2,1)+0.1)
panel(abs(log(sec.pc)),log(auc.pc), ylim=c(0,0.04), ylab="auc increase (%)")
mtext(at=c(0,0), "A. AUC vs speed", adj=0, font=2)
panel(abs(log(sec.pc)),log(cor.pc), ylim=c(0,0.07), ylab="corr increase (%)")
mtext(at=c(0,0), "B. Correlation vs speed", adj=0, font=2)
panel(abs(log(sec.pc)), log(kd.pc),ylim=c(-0.1,0.1), ylab="kd success (%)")
mtext(at=c(0,0), "C. KD success vs speed", adj=0, font=2)

# Ensambles 20 x 20
# auc.ens <- sapply(auc, function(x) auc + (x - auc*x)*runif(1))
# sec.ens <- sapply(sec, function(x) sec + x)
# plot(auc.ens ~ log(sec.ens), pch=16)
```


